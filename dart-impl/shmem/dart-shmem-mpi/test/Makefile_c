DART_ROOT = $(shell pwd)/../../..
LIBDART   = $(DART_ROOT)/dart-shmem/libdart.a -lpthread
DART_INC  = $(DART_ROOT)/../../dart-if/v2.1

include $(DART_ROOT)/make.defs

DARTMPI_ROOT = $(shell pwd)/../..
DARTMPI_INC  = $(DARTMPI_ROOT)/include

LIBDARTMPI = $(DARTMPI_ROOT)/lib/libdartmpi.a

PWD  = $(shell basename `pwd`)
PAT  = $(shell echo -n $(PWD) )
PROG = $(shell echo -n $(PAT) | cut -d . -f 3)

all : $(LIBDART) $(LIBDARTMPI) $(PROG)

printenv : 
	 @echo "DART_ROOT    = $(DART_ROOT)"
	 @echo "LIBDART      = $(LIBDART)"
	 @echo "DART_INC     = $(DART_INC)"
	 @echo "DARTMPI_ROOT = $(DARTMPI_ROOT)"
	 @echo "DARTMPI_INC  = $(DARTMPI_INC)"

$(LIBDART) :
	make -C $(DART_ROOT)/dart-shmem/

$(LIBDARTMPI) :
	make -C $(DARTMPI_ROOT)/lib
	
	     

$(PROG) : main.o
	$(CC) $(LFLGAS) -o $@ $+ $(LIBDARTMPI) $(LIBDART) 

%.o 	: %.c 
	$(CC) -c $(CFLAGS) -I$(DARTMPI_INC) -I$(DART_INC) $+

clean : 
	rm -f *.o *~
	rm -f $(PROG)
